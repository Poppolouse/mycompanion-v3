import React, { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { useRoute } from '../../contexts/RouteContext';
import './RoutePlanner.css';

/**
 * RoutePlanner - VAULT ROUTE v2.2 takip sistemi
 * 
 * 117 oyunluk route sistemini y√∂netmek i√ßin ana sayfa
 * - Sol sidebar: Aktif cycle, hƒ±zlƒ± eri≈üim, filtreler
 * - Ana i√ßerik: Progress bar, aktif/sonraki cycle, cycle listesi
 */
function RoutePlanner() {
  const navigate = useNavigate();
  
  const { 
    routeState, 
    loading, 
    getCurrentCycle, 
    getNextCycle, 
    getActiveGame, 
    getRouteProgress,
    startRoute,
    startCycle,
    selectGame: contextSelectGame,
    completeGame: contextCompleteGame,
    ROUTE_CONFIG 
  } = useRoute();

  // Filter state
  const [activeFilters, setActiveFilters] = useState({
    rpg: false,
    story: false,
    strategy: false,
    favorites: false,
    status: 'all' // all, completed, active, pending
  });

  // Rule guide modal state
  const [showRuleGuide, setShowRuleGuide] = useState(false);
  const [ruleGuideType, setRuleGuideType] = useState(null); // 'completion' | 'route'

  // Oyun se√ßimi i√ßin state'ler
  const [showGameSelector, setShowGameSelector] = useState(false);
  const [selectedGameType, setSelectedGameType] = useState(null);
  
  // Toast notification state
  const [toasts, setToasts] = useState([]);
  
  // Dark mode her zaman aktif (light mode kaldƒ±rƒ±ldƒ±)
  const isDarkMode = true;
  
  // Ana ekrana d√∂nme fonksiyonu
  const goToHome = () => {
    navigate('/');
  };

  const goToGameHub = () => {
    navigate('/game-tracking-hub');
  };
  
  // Dark mode class'ƒ±nƒ± body'ye ekle/√ßƒ±kar
  useEffect(() => {
    if (isDarkMode) {
      document.body.classList.add('dark-mode');
    } else {
      document.body.classList.remove('dark-mode');
    }
  }, [isDarkMode]);
  
  // Toast notification fonksiyonlarƒ±
  const showToast = (message, type = 'success') => {
    const id = Date.now();
    const newToast = { id, message, type };
    setToasts(prev => [...prev, newToast]);
    
    // 3 saniye sonra otomatik kaldƒ±r
    setTimeout(() => {
      removeToast(id);
    }, 3000);
  };
  
  const removeToast = (id) => {
    setToasts(prev => prev.filter(toast => toast.id !== id));
  };
  
  // Basit oyun listesi (ger√ßek uygulamada API'den gelecek)
  const gameDatabase = {
    rpg: [
      { id: 'witcher3', name: 'The Witcher 3: Wild Hunt', hours: 50 },
      { id: 'skyrim', name: 'The Elder Scrolls V: Skyrim', hours: 60 },
      { id: 'persona5', name: 'Persona 5 Royal', hours: 80 },
      { id: 'divinity2', name: 'Divinity: Original Sin 2', hours: 70 }
    ],
    story: [
      { id: 'firewatch', name: 'Firewatch', hours: 6 },
      { id: 'life_strange', name: 'Life is Strange', hours: 12 },
      { id: 'what_remains', name: 'What Remains of Edith Finch', hours: 3 },
      { id: 'stanley', name: 'The Stanley Parable', hours: 4 }
    ],
    strategy: [
      { id: 'civ6', name: 'Civilization VI', hours: 40 },
      { id: 'xcom2', name: 'XCOM 2', hours: 35 },
      { id: 'total_war', name: 'Total War: Warhammer III', hours: 50 },
      { id: 'crusader', name: 'Crusader Kings III', hours: 60 }
    ]
  };

  // Filter functions
  const toggleFilter = (filterType) => {
    setActiveFilters(prev => ({
      ...prev,
      [filterType]: !prev[filterType]
    }));
  };

  const setStatusFilter = (status) => {
    setActiveFilters(prev => ({
      ...prev,
      status
    }));
  };

  // Filter cycles based on active filters
  const getFilteredCycles = () => {
    return routeState.cycles.filter(cycle => {
      // Oyun t√ºr√º filtreleri
      if (activeFilters.rpg || activeFilters.story || activeFilters.strategy) {
        const hasRPG = cycle.games.some(g => g.type === 'rpg');
        const hasStory = cycle.games.some(g => g.type === 'story');
        const hasStrategy = cycle.games.some(g => g.type === 'strategy');
        
        if (activeFilters.rpg && !hasRPG) return false;
        if (activeFilters.story && !hasStory) return false;
        if (activeFilters.strategy && !hasStrategy) return false;
      }
      
      // Durum filtresi
      if (activeFilters.status !== 'all') {
        const cycleStatus = 
          cycle.cycleNumber < config.currentCycle ? 'completed' :
          cycle.cycleNumber === config.currentCycle ? 
            (!config.currentCycleStarted ? 'pending' : 'active') :
          'pending';
        
        if (activeFilters.status !== cycleStatus) return false;
      }
      
      return true;
    });
  };

  // Oyun se√ßme fonksiyonu
  const selectGame = (gameType) => {
    setSelectedGameType(gameType);
    setShowGameSelector(true);
  };
  
  // Oyun se√ßimini onayla
  const confirmGameSelection = (gameId) => {
    const currentCycle = getCurrentCycle();
    if (!currentCycle || !selectedGameType) return;
    
    // Oyun t√ºr√ºne g√∂re position bulma
    const gamePosition = currentCycle.games.findIndex(g => g.type === selectedGameType);
    if (gamePosition === -1) return;
    
    // Se√ßilen oyunun adƒ±nƒ± bul
    const selectedGame = gameDatabase[selectedGameType]?.find(game => game.id === gameId);
    
    contextSelectGame(currentCycle.cycleNumber, gamePosition, gameId);
    setShowGameSelector(false);
    setSelectedGameType(null);
    
    // Toast notification g√∂ster
    showToast(`üéÆ ${selectedGame?.name || 'Oyun'} se√ßildi!`, 'success');
  };

  // Oyun tamamlama fonksiyonu
  const completeGame = (gameType) => {
    const currentCycle = getCurrentCycle();
    if (!currentCycle) return;
    
    // Oyun t√ºr√ºne g√∂re position bulma
    const gamePosition = currentCycle.games.findIndex(g => g.type === gameType);
    if (gamePosition === -1) return;
    
    // Basit saat hesaplamasƒ± (ger√ßek uygulamada kullanƒ±cƒ±dan alƒ±nacak)
    const estimatedHours = gameType === 'rpg' ? 50 : gameType === 'story' ? 15 : 30;
    
    contextCompleteGame(currentCycle.cycleNumber, gamePosition, estimatedHours);
    
    // Toast notification g√∂ster
    const gameTypeNames = {
      rpg: 'RPG',
      story: 'Story/Indie',
      strategy: 'Strategy/Sim'
    };
    showToast(`‚úÖ ${gameTypeNames[gameType]} oyunu tamamlandƒ±!`, 'success');
  };

  // Sonraki cycle'a ge√ßi≈ü fonksiyonu
  const goToNextCycle = () => {
    const currentCycle = getCurrentCycle();
    if (!currentCycle) return;
    
    // T√ºm oyunlar tamamlandƒ± mƒ± kontrol et
    const allCompleted = currentCycle.games.every(g => g.status === 'completed');
    if (!allCompleted) return;
    
    // Sonraki cycle'ƒ± ba≈ülat
    const nextCycleNumber = currentCycle.cycleNumber + 1;
    if (nextCycleNumber <= ROUTE_CONFIG.totalCycles) {
      startCycle(nextCycleNumber);
      showToast(`üöÄ Cycle ${nextCycleNumber} ba≈ülatƒ±ldƒ±!`, 'success');
    } else {
      showToast(`üéâ Tebrikler! T√ºm route tamamlandƒ±!`, 'success');
    }
  };

  if (loading) {
    return (
      <div className="route-planner">
        <div className="loading-state">
          <h2>üéØ Route Planner Y√ºkleniyor...</h2>
        </div>
      </div>
    );
  }

  const currentCycle = getCurrentCycle();
  const nextCycle = getNextCycle();
  const activeGame = getActiveGame();
  const routeProgress = getRouteProgress();
  const { config, analytics } = routeState;

  return (
    <div className="route-planner">
      {/* Genel ƒ∞lerleme Barƒ± */}
      <div className="route-planner__progress-bar">
        {/* Modern Header Card */}
        <div className="modern-header">
          <div className="header-left">
            <button 
              className="nav-button home-button"
              onClick={goToHome}
              title="Ana Sayfaya D√∂n"
            >
              üè†
            </button>
            <button 
              className="nav-button hub-button"
              onClick={goToGameHub}
              title="Oyun Hub'ƒ±na D√∂n"
            >
              üéÆ Hub
            </button>
          </div>
          
          <div className="header-center">
            <h1 className="route-title">üéØ VAULT ROUTE v2.2</h1>
          </div>
        </div>
        <div className="progress-info">
          <span>
            Cycle {config.currentCycle}/{ROUTE_CONFIG.totalCycles} ‚Ä¢ 
            Oyun {analytics.completedGames + 1}/{ROUTE_CONFIG.totalGames}
          </span>
          <div className="progress-bar">
            <div className="progress-fill" style={{ width: `${routeProgress}%` }}></div>
          </div>
          <span>%{routeProgress} Tamamlandƒ±</span>
        </div>
      </div>

      <div className="route-planner__content">
        {/* Sol Sidebar */}
        <div className="route-planner__sidebar slide-in-left">
          <div className="sidebar-section fade-in">
            <h3>üéØ AKTƒ∞F CYCLE</h3>
            <div className="active-cycle-info">
              <p>Cycle {config.currentCycle}/{ROUTE_CONFIG.totalCycles}</p>
              <p>
                {activeGame 
                  ? `Aktif: ${activeGame.type} Oyunu`
                  : `Oyun Se√ßilmedi`
                }
              </p>
              <p>ƒ∞lerleme: %{currentCycle ? Math.round(
                (currentCycle.games.filter(g => g.status === 'completed').length / 3) * 100
              ) : 0}</p>
              <p>
                Toplam S√ºre: {analytics.totalHoursPlayed}h / 
                {currentCycle ? currentCycle.estimatedHours : 0}h
              </p>
            </div>
          </div>

          <div className="sidebar-section">
            <h3>‚ö° QUICK ACCESS</h3>
            <div className="quick-actions">
              <button 
                className="quick-btn"
                onClick={() => {
                  if (!config.routeStarted) {
                    startRoute();
                  } else if (!config.currentCycleStarted) {
                    startCycle();
                  }
                }}
                disabled={config.routeStarted && config.currentCycleStarted}
              >
                {!config.routeStarted ? 'üöÄ Route Ba≈ülat' : 
                 !config.currentCycleStarted ? 'üéØ Cycle Ba≈ülat' : 
                 'üéÆ Oyun Se√ß'}
              </button>
              <button 
                className="quick-btn"
                disabled={!activeGame}
              >
                ‚úÖ Tamamla
              </button>
              <button 
                className="quick-btn"
                disabled={!currentCycle || currentCycle.games.filter(g => g.status === 'completed').length < 3}
              >
                ‚è≠Ô∏è Sonraki Cycle
              </button>
              <button 
                className="quick-btn"
                onClick={() => window.location.href = '/statistics'}
              >
                üìä ƒ∞statistikler
              </button>
            </div>
          </div>

          <div className="sidebar-section">
            <h3>üìã Fƒ∞LTRELER</h3>
            
            {/* Game Type Filters */}
            <div className="filter-group">
              <h4>Oyun T√ºr√º</h4>
              <button 
                className={`filter-btn ${activeFilters.rpg ? 'active' : ''}`}
                onClick={() => toggleFilter('rpg')}
              >
                üó°Ô∏è RPG
              </button>
              <button 
                className={`filter-btn ${activeFilters.story ? 'active' : ''}`}
                onClick={() => toggleFilter('story')}
              >
                üìñ Story/Indie
              </button>
              <button 
                className={`filter-btn ${activeFilters.strategy ? 'active' : ''}`}
                onClick={() => toggleFilter('strategy')}
              >
                üèóÔ∏è Strategy/Sim
              </button>
            </div>

            {/* Status Filters */}
            <div className="filter-group">
              <h4>Durum</h4>
              <button 
                className={`filter-btn ${activeFilters.status === 'all' ? 'active' : ''}`}
                onClick={() => setStatusFilter('all')}
              >
                üìã T√ºm√º
              </button>
              <button 
                className={`filter-btn ${activeFilters.status === 'active' ? 'active' : ''}`}
                onClick={() => setStatusFilter('active')}
              >
                üî• Aktif
              </button>
              <button 
                className={`filter-btn ${activeFilters.status === 'completed' ? 'active' : ''}`}
                onClick={() => setStatusFilter('completed')}
              >
                ‚úÖ Tamamlandƒ±
              </button>
              <button 
                className={`filter-btn ${activeFilters.status === 'pending' ? 'active' : ''}`}
                onClick={() => setStatusFilter('pending')}
              >
                ‚è≥ Beklemede
              </button>
            </div>

            {/* Clear Filters */}
            <button 
              className="clear-filters-btn"
              onClick={() => setActiveFilters({
                rpg: false,
                story: false,
                strategy: false,
                favorites: false,
                status: 'all'
              })}
            >
              üóëÔ∏è Filtreleri Temizle
            </button>
          </div>

          <div className="sidebar-section">
            <h3>üìñ KURAL KILAVUZU</h3>
            <button 
              className="rule-btn"
              onClick={() => {
                setRuleGuideType('completion');
                setShowRuleGuide(true);
              }}
            >
              ‚úÖ Tamamlama Kriterleri
            </button>
            <button 
              className="rule-btn"
              onClick={() => {
                setRuleGuideType('route');
                setShowRuleGuide(true);
              }}
            >
              üéØ Route Sistemi
            </button>
            <button 
              className="rule-btn"
              onClick={() => {
                setRuleGuideType('tips');
                setShowRuleGuide(true);
              }}
            >
              üí° ƒ∞pu√ßlarƒ± & Stratejiler
            </button>
          </div>
        </div>

        {/* Ana ƒ∞√ßerik */}
        <div className="route-planner__main">
          <div className="main-content slide-in-right">
            {/* Detaylƒ± Progress Section */}
            <div className="detailed-progress-section fade-in">
              <h2>üìä Route ƒ∞lerlemesi</h2>
              <div className="progress-stats">
                <div className="stat-card fade-in" style={{'--animation-delay': '0.1s'}}>
                  <h4>üéØ Genel ƒ∞lerleme</h4>
                  <div className="progress-circle">
                    <span className="progress-text">{routeProgress}%</span>
                  </div>
                  <p>{analytics.completedGames}/{analytics.totalGames} Oyun</p>
                </div>
                <div className="stat-card fade-in" style={{'--animation-delay': '0.2s'}}>
                  <h4>üî• Aktif Cycle</h4>
                  <div className="cycle-progress">
                    <span className="cycle-number">#{config.currentCycle}</span>
                    <div className="cycle-status">
                      {!config.currentCycleStarted ? '‚è∏Ô∏è Ba≈ülamadƒ±' : 
                       currentCycle?.games.filter(g => g.status === 'completed').length === 3 ? '‚úÖ Tamamlandƒ±' :
                       'üéÆ Devam Ediyor'}
                    </div>
                  </div>
                  <p>{currentCycle?.games.filter(g => g.status !== 'not_started').length || 0}/3 Oyun Se√ßildi</p>
                </div>
                <div className="stat-card fade-in" style={{'--animation-delay': '0.3s'}}>
                  <h4>‚è±Ô∏è Zaman</h4>
                  <div className="time-stats">
                    <span className="hours-played">{analytics.totalHours}h</span>
                    <span className="hours-estimated">/{analytics.estimatedHours}h</span>
                  </div>
                  <p>Tahmini S√ºre</p>
                </div>
              </div>
            </div>

            <h2>üéØ Aktif & Sonraki Cycle'lar</h2>
            
            <div className="cycle-cards">
              {/* Aktif Cycle */}
              {currentCycle && (
                <div className="cycle-card active">
                  <div className="cycle-header">
                    <h3>üî• AKTƒ∞F CYCLE - Cycle {currentCycle.cycleNumber}</h3>
                    <div className="cycle-progress-bar">
                      <div 
                        className="progress-fill" 
                        style={{width: `${Math.round((currentCycle.games.filter(g => g.status === 'completed').length / 3) * 100)}%`}}
                      ></div>
                    </div>
                  </div>
                  
                  <div className="cycle-info">
                    <div className="cycle-status">
                      <span className="status-badge">
                        {!config.currentCycleStarted ? '‚è∏Ô∏è Ba≈ülamadƒ±' :
                         currentCycle.games.filter(g => g.status === 'completed').length === 3 ? '‚úÖ Tamamlandƒ±' :
                         'üéÆ Devam Ediyor'}
                      </span>
                      <span className="game-count">
                        {currentCycle.games.filter(g => g.status !== 'not_started').length}/3 Oyun
                      </span>
                    </div>
                  </div>

                  <div className="cycle-games">
                    {currentCycle.games.map((game, index) => (
                      <div key={index} className={`game-slot ${game.status}`}>
                        <div className="game-type">
                          {game.type === 'rpg' ? 'üó°Ô∏è RPG' : 
                           game.type === 'story' ? 'üìñ Story' : 
                           game.type === 'strategy' ? 'üèóÔ∏è Strategy' : 'üéÆ Game'}
                        </div>
                        <div className="game-name">
                          {game.status === 'not_started' ? 'Oyun Se√ßilmedi' : 
                           game.name || `${game.type.toUpperCase()} Oyunu`}
                        </div>
                        <div className="game-actions">
                          {game.status === 'not_started' && config.currentCycleStarted && (
                            <button className="select-game-btn" onClick={() => selectGame(game.type)}>
                              Se√ß
                            </button>
                          )}
                          {game.status === 'selected' && (
                            <button className="complete-game-btn" onClick={() => completeGame(game.type)}>
                              Tamamla
                            </button>
                          )}
                          {game.status === 'completed' && (
                            <span className="completed-badge">‚úÖ</span>
                          )}
                        </div>
                      </div>
                    ))}
                  </div>
                  
                  <div className="cycle-actions">
                    <button 
                      className="cycle-btn primary"
                      onClick={() => {
                        if (!config.currentCycleStarted) {
                          startCycle(currentCycle.cycleNumber);
                        }
                      }}
                      disabled={config.currentCycleStarted}
                    >
                      {!config.currentCycleStarted ? 'üöÄ Cycle Ba≈ülat' : 'üéÆ Devam Ediyor'}
                    </button>
                    {config.currentCycleStarted && currentCycle.games.filter(g => g.status === 'completed').length === 3 && (
                      <button className="cycle-btn success" onClick={goToNextCycle}>
                        ‚û°Ô∏è Sonraki Cycle
                      </button>
                    )}
                  </div>
                </div>
              )}
              
              {/* Sonraki Cycle */}
              {nextCycle && (
                <div className="cycle-card next">
                  <div className="cycle-header">
                    <h3>‚è≥ SONRAKƒ∞ CYCLE - Cycle {nextCycle.cycleNumber}</h3>
                    <div className="cycle-progress-bar">
                      <div className="progress-fill" style={{width: '0%'}}></div>
                    </div>
                  </div>
                  
                  <div className="cycle-info">
                    <div className="cycle-status">
                      <span className="status-badge">‚è≥ Beklemede</span>
                      <span className="game-count">0/3 Oyun</span>
                    </div>
                  </div>

                  <div className="cycle-games">
                    {nextCycle.games.map((game, index) => (
                      <div key={index} className="game-slot not_started">
                        <div className="game-type">
                          {game.type === 'rpg' ? 'üó°Ô∏è RPG' : 
                           game.type === 'story' ? 'üìñ Story' : 
                           game.type === 'strategy' ? 'üèóÔ∏è Strategy' : 'üéÆ Game'}
                        </div>
                        <div className="game-name">Beklemede</div>
                        <div className="game-actions">
                          <span className="waiting-badge">‚è≥</span>
                        </div>
                      </div>
                    ))}
                  </div>
                  
                  <div className="cycle-actions">
                    <button className="cycle-btn disabled" disabled>
                      üîí Aktif Cycle'ƒ± Tamamla
                    </button>
                  </div>
                </div>
              )}
            </div>
            
            <h2>üìã T√ºm Cycle'lar</h2>
            <div className="filter-info">
              {Object.values(activeFilters).some(f => f !== false && f !== 'all') && (
                <p className="active-filters">
                  üîç Filtreler aktif: {getFilteredCycles().length}/{routeState.cycles.length} cycle g√∂steriliyor
                </p>
              )}
            </div>
            <div className="all-cycles">
              {getFilteredCycles().slice(0, 15).map((cycle) => {
                const completedGames = cycle.games.filter(g => g.status === 'completed').length;
                const progress = Math.round((completedGames / 3) * 100);
                
                return (
                  <div key={cycle.cycleNumber} className="cycle-item">
                    <span>Cycle {cycle.cycleNumber}</span>
                    <span>{
                      cycle.cycleNumber < config.currentCycle ? 'Tamamlandƒ±' :
                      cycle.cycleNumber === config.currentCycle ? 
                        (!config.currentCycleStarted ? 'Ba≈ülamadƒ±' : 'Devam Ediyor') :
                      'Beklemede'
                    }</span>
                    <span>{cycle.games.filter(g => g.status !== 'not_started').length}/3</span>
                    <span>%{progress}</span>
                    <span className="cycle-games-preview">
                      {cycle.games.map(g => 
                        g.type === 'rpg' ? 'üó°Ô∏è' : 
                        g.type === 'story' ? 'üìñ' : 
                        g.type === 'strategy' ? 'üèóÔ∏è' : 'üéÆ'
                      ).join(' ')}
                    </span>
                  </div>
                );
              })}
              {getFilteredCycles().length > 15 && (
                <div className="cycle-item more">
                  <span>... ve {getFilteredCycles().length - 15} cycle daha</span>
                </div>
              )}
              {getFilteredCycles().length === 0 && (
                <div className="cycle-item no-results">
                  <span>üîç Filtre kriterlerine uygun cycle bulunamadƒ±</span>
                </div>
              )}
            </div>
          </div>
        </div>
        </div>

        {/* Rule Guide Modal */}
        {showRuleGuide && (
          <div className="modal-overlay" onClick={() => setShowRuleGuide(false)}>
            <div className="modal-content" onClick={(e) => e.stopPropagation()}>
              <div className="modal-header">
                <h2>
                  {ruleGuideType === 'completion' && '‚úÖ Tamamlama Kriterleri'}
                  {ruleGuideType === 'route' && 'üéØ Route Sistemi'}
                  {ruleGuideType === 'tips' && 'üí° ƒ∞pu√ßlarƒ± & Stratejiler'}
                </h2>
                <button 
                  className="modal-close"
                  onClick={() => setShowRuleGuide(false)}
                >
                  ‚úï
                </button>
              </div>
              
              <div className="modal-body">
                {ruleGuideType === 'completion' && (
                  <div className="rule-content">
                    <h3>üéÆ Oyun Tamamlama Kriterleri</h3>
                    <ul>
                      <li><strong>üó°Ô∏è RPG Oyunlarƒ±:</strong> Ana hikaye + √∂nemli side quest'ler (minimum 40-60 saat)</li>
                      <li><strong>üìñ Story/Indie:</strong> Ana hikaye tamamlanmalƒ± (10-20 saat)</li>
                      <li><strong>üèóÔ∏è Strategy/Sim:</strong> Temel mekanikleri √∂ƒürenme + 1 kampanya (20-40 saat)</li>
                    </ul>
                    
                    <h3>‚è±Ô∏è S√ºre Limitleri</h3>
                    <ul>
                      <li>Her cycle maksimum <strong>3 ay</strong> s√ºrmeli</li>
                      <li>Oyun ba≈üƒ±na minimum <strong>10 saat</strong> oynanmalƒ±</li>
                      <li>Eƒüer oyun beƒüenilmezse <strong>5 saat</strong> sonra bƒ±rakƒ±labilir</li>
                    </ul>
                  </div>
                )}
                
                {ruleGuideType === 'route' && (
                  <div className="rule-content">
                    <h3>üéØ VAULT ROUTE v2.2 Sistemi</h3>
                    <ul>
                      <li><strong>39 Cycle:</strong> Toplam 117 oyun (3 oyun/cycle)</li>
                      <li><strong>Oyun T√ºrleri:</strong> Her cycle'da 1 RPG, 1 Story/Indie, 1 Strategy/Sim</li>
                      <li><strong>Sƒ±ralƒ± ƒ∞lerleme:</strong> Cycle'lar sƒ±rayla tamamlanmalƒ±</li>
                      <li><strong>Esneklik:</strong> Cycle i√ßinde oyun sƒ±rasƒ± deƒüi≈ütirilebilir</li>
                    </ul>
                    
                    <h3>üìä ƒ∞lerleme Takibi</h3>
                    <ul>
                      <li>Her oyun i√ßin s√ºre ve ilerleme kaydedilir</li>
                      <li>Cycle tamamlandƒ±ƒüƒ±nda sonraki cycle a√ßƒ±lƒ±r</li>
                      <li>ƒ∞statistikler ve analytics s√ºrekli g√ºncellenir</li>
                    </ul>
                  </div>
                )}
                
                {ruleGuideType === 'tips' && (
                  <div className="rule-content">
                    <h3>üí° Ba≈üarƒ± ƒ∞pu√ßlarƒ±</h3>
                    <ul>
                      <li><strong>üéØ Hedef Belirleme:</strong> Her cycle i√ßin net hedefler koy</li>
                      <li><strong>‚è∞ Zaman Y√∂netimi:</strong> G√ºnl√ºk 1-2 saat oyun oyna</li>
                      <li><strong>üìù Not Tutma:</strong> Oyun deneyimlerini kaydet</li>
                      <li><strong>üîÑ √áe≈üitlilik:</strong> Farklƒ± t√ºrleri dengeyle</li>
                    </ul>
                    
                    <h3>üö´ Ka√ßƒ±nƒ±lmasƒ± Gerekenler</h3>
                    <ul>
                      <li>Aynƒ± anda √ßok fazla oyun oynamak</li>
                      <li>Cycle'larƒ± atlamak veya karƒ±≈ütƒ±rmak</li>
                      <li>Oyunlarƒ± yarƒ±m bƒ±rakmak (5 saat kuralƒ± hari√ß)</li>
                      <li>ƒ∞statistikleri takip etmemek</li>
                    </ul>
                  </div>
                )}
              </div>
              
              <div className="modal-footer">
                <button 
                  className="modal-btn"
                  onClick={() => setShowRuleGuide(false)}
                >
                  Anladƒ±m
                </button>
              </div>
            </div>
          </div>
        )}

        {/* Game Selector Modal */}
        {showGameSelector && selectedGameType && (
          <div className="modal-overlay" onClick={() => setShowGameSelector(false)}>
            <div className="modal-content game-selector-modal" onClick={(e) => e.stopPropagation()}>
              <div className="modal-header">
                <h2>
                  {selectedGameType === 'rpg' && 'üó°Ô∏è RPG Oyunu Se√ß'}
                  {selectedGameType === 'story' && 'üìñ Story/Indie Oyunu Se√ß'}
                  {selectedGameType === 'strategy' && 'üèóÔ∏è Strategy/Sim Oyunu Se√ß'}
                </h2>
                <button 
                  className="modal-close"
                  onClick={() => setShowGameSelector(false)}
                >
                  ‚úï
                </button>
              </div>
              
              <div className="modal-body">
                <div className="game-list">
                  {gameDatabase[selectedGameType]?.map(game => (
                    <div key={game.id} className="game-option" onClick={() => confirmGameSelection(game.id)}>
                      <div className="game-info">
                        <h4>{game.name}</h4>
                        <p>‚è±Ô∏è Tahmini s√ºre: {game.hours} saat</p>
                      </div>
                      <button className="btn-select">Se√ß</button>
                    </div>
                  ))}
                </div>
              </div>
              
              <div className="modal-footer">
                <button 
                  className="modal-btn secondary"
                  onClick={() => setShowGameSelector(false)}
                >
                  ƒ∞ptal
                </button>
              </div>
            </div>
           </div>
         )}

        {/* Toast Notifications */}
        <div className="toast-container">
          {toasts.map(toast => (
            <div 
              key={toast.id} 
              className={`toast toast-${toast.type}`}
              onClick={() => removeToast(toast.id)}
            >
              <span>{toast.message}</span>
              <button className="toast-close" onClick={() => removeToast(toast.id)}>√ó</button>
            </div>
          ))}
        </div>
      </div>
    );
  }
  
  export default RoutePlanner;